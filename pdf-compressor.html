<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>QuickPDFtools — Merge & Compress PDFs (Free + Paid)</title>
  <meta name="description" content="QuickPDFtools — Fast, mobile-first online PDF Merge and Compress. Free to use, no signup. Optimized for performance and privacy.">
  <meta name="keywords" content="merge pdf, compress pdf, pdf merge online, pdf compress mobile, free pdf tools">
  <meta name="author" content="QuickPDFtools">
  <meta name="theme-color" content="#E43D30">
  <link rel="canonical" href="https://yourdomain.com/">

  <!-- OpenGraph -->
  <meta property="og:title" content="QuickPDFtools — Merge & Compress PDFs">
  <meta property="og:description" content="Fast, mobile-first PDF Merge and Compress. Free usage with premium upgrades.">
  <meta property="og:type" content="website">

  <!-- Basic styling (mobile-first) -->
  <style>
    :root{--red:#E43D30;--bg:#ffffff;--muted:#6b7280;--card:#f8fafc}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:var(--bg);color:#0f172a;-webkit-font-smoothing:antialiased}
    .container{max-width:980px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;gap:12px}
    .brand{display:flex;flex-direction:column}
    .logo{display:flex;align-items:center;gap:8px}
    .logo .mark{width:44px;height:44px;border-radius:8px;background:var(--red);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    h1{font-size:20px;margin:0}
    p.lead{margin:6px 0 18px;color:var(--muted);font-size:13px}

    /* Tabs */
    .tabs{display:flex;gap:8px;margin:12px 0 18px}
    .tab{padding:10px 14px;border-radius:10px;background:var(--card);cursor:pointer;font-weight:600;color:#0f172a}
    .tab.active{background:linear-gradient(90deg,var(--red),#ff6b61);color:white}

    /* Card */
    .card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(12,18,26,0.04);margin-bottom:12px}
    .uploader{display:flex;gap:10px;align-items:center;flex-direction:column}
    .file-list{width:100%;display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .file-row{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px dashed #e6edf3}
    .btn{background:var(--red);color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#111827;color:#fff}
    .btn.ghost{background:transparent;color:var(--red);border:1px solid #f3d6d6}
    input[type=file]{display:none}
    .actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .small{font-size:13px;color:var(--muted)}
    footer{margin:26px 0 80px;color:var(--muted);font-size:12px;text-align:center}

    /* responsive grid for desktop */
    @media(min-width:768px){
      h1{font-size:24px}
      .tools-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
      .uploader{align-items:flex-start}
    }

    .progress{height:6px;background:#fff;border-radius:6px;overflow:hidden;border:1px solid #eef2f6}
    .progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--red),#ff7b6a)}

    .note{font-size:13px;color:var(--muted)}
    .center{display:flex;align-items:center;justify-content:center}
  </style>

  <!-- Libraries: load with defer -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js" defer id="pdfjs-script"></script>
  <script id="pdfjs-worker-config" defer>
    (function(){
      function ensureWorker(){
        if(window.pdfjsLib){
          try{ window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js'; }catch(e){console.warn('Could not set pdfjs workerSrc',e)}
        }else{ setTimeout(ensureWorker,50); }
      }
      ensureWorker();
    })();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="mark">Q</div>
      </div>
      <div class="brand">
        <h1>QuickPDFtools <span style="font-weight:400;font-size:13px;color:var(--muted)">[Free] + [Paid]</span></h1>
        <p class="lead">Fast mobile-first PDF Merge and Compress — free, private, and easy to use.</p>
      </div>
    </header>

    <nav class="tabs" role="tablist">
      <div class="tab active" id="tab-merge" role="tab">Merge PDF</div>
      <div class="tab" id="tab-compress" role="tab">Compress PDF</div>
    </nav>

    <main>
      <div class="tools-grid">
        <section id="merge" class="card" role="region" aria-labelledby="tab-merge">
          <h2 style="margin:0 0 8px">Merge PDF Files</h2>
          <p class="small">Select multiple PDF files and merge them in the order you choose. Files are processed in your browser — we don't upload them to any server.</p>

          <div class="uploader">
            <label class="btn" for="merge-files">Select PDF files</label>
            <input id="merge-files" type="file" accept="application/pdf" multiple>

            <div class="file-list" id="merge-list"></div>

            <div class="actions">
              <button id="merge-button" class="btn">Merge Now</button>
              <button id="merge-clear" class="btn ghost">Clear</button>
              <a id="merge-download" class="btn secondary" style="display:none" download="merged.pdf">Download</a>
            </div>

            <div style="width:100%;margin-top:10px">
              <div class="progress" aria-hidden><i id="merge-progress"></i></div>
            </div>

            <p class="note">Tip: Drag files in the order you want before merging. Works fully client-side.</p>
          </div>
        </section>

        <section id="compress" class="card" role="region" aria-labelledby="tab-compress">
          <h2 style="margin:0 0 8px">Compress PDF</h2>
          <p class="small">Compress PDFs by rasterizing each page and embedding as compressed JPEG inside a new PDF. Best for image-heavy PDFs.</p>

          <div class="uploader">
            <label class="btn" for="compress-file">Select a PDF file</label>
            <input id="compress-file" type="file" accept="application/pdf">

            <div class="file-list" id="compress-list"></div>

            <div style="width:100%;display:flex;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap">
              <label class="small">Quality:</label>
              <select id="quality" style="padding:8px;border-radius:8px;border:1px solid #e6edf3">
                <option value="0.9">High (0.9)</option>
                <option value="0.8" selected>Good (0.8)</option>
                <option value="0.6">Medium (0.6)</option>
                <option value="0.4">Low (0.4)</option>
              </select>
            </div>

            <div class="actions">
              <button id="compress-button" class="btn">Compress Now</button>
              <button id="compress-clear" class="btn ghost">Clear</button>
              <a id="compress-download" class="btn secondary" style="display:none" download="compressed.pdf">Download</a>
            </div>

            <div style="width:100%;margin-top:10px">
              <div class="progress" aria-hidden><i id="compress-progress"></i></div>
            </div>

            <p class="note">Note: Large PDFs may take more time and memory. For best results, use "Good (0.8)" on mobile.</p>
          </div>
        </section>
      </div>
    </main>

    <footer>
      Built with ❤️ — QuickPDFtools. Files are processed locally in your browser and not uploaded. For faster processing or larger files consider our paid plan.
    </footer>
  </div>

  <!-- App logic -->
  <script>
    // Utility: wait until a global variable exists (simple polling)
    function waitForGlobal(name, timeout = 10000){
      return new Promise((resolve, reject)=>{
        const start = Date.now();
        (function check(){
          if(window[name]) return resolve(window[name]);
          if(Date.now() - start > timeout) return reject(new Error(name + ' not available'));
          setTimeout(check, 50);
        })();
      });
    }

    document.addEventListener('DOMContentLoaded', async ()=>{
      // Tabs
      const tabMerge = document.getElementById('tab-merge');
      const tabCompress = document.getElementById('tab-compress');
      const mergeSection = document.getElementById('merge');
      const compressSection = document.getElementById('compress');
      tabMerge.addEventListener('click', ()=>{tabMerge.classList.add('active');tabCompress.classList.remove('active');mergeSection.style.display='block';compressSection.style.display='none'});
      tabCompress.addEventListener('click', ()=>{tabCompress.classList.add('active');tabMerge.classList.remove('active');mergeSection.style.display='none';compressSection.style.display='block'});

      // Wait for libraries
      try{ await waitForGlobal('PDFLib',5000); }catch(e){console.warn('PDFLib not loaded in time',e)}
      let pdfjsLib = null; let jsPDFCtor = null;
      try{ pdfjsLib = await waitForGlobal('pdfjsLib',10000); pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js'; }catch(e){console.error('pdfjsLib failed to load',e)}
      try{ const jspdfGlobal = await waitForGlobal('jspdf',5000).catch(()=>window.jspdf); if(jspdfGlobal){ jsPDFCtor = jspdfGlobal.jsPDF || jspdfGlobal; } }catch(e){console.warn('jsPDF not available',e)}

      // --- Merge logic ---
      const mergeInput = document.getElementById('merge-files');
      const mergeList = document.getElementById('merge-list');
      const mergeBtn = document.getElementById('merge-button');
      const mergeClear = document.getElementById('merge-clear');
      const mergeProgress = document.getElementById('merge-progress');
      const mergeDownload = document.getElementById('merge-download');
      let mergeFiles = [];
      let lastMergedUrl = null;

      function renderMergeList(){
        mergeList.innerHTML = '';
        mergeFiles.forEach((f, i)=>{
          const row = document.createElement('div');row.className='file-row';
          const name = document.createElement('div');name.textContent = (i+1)+'. '+f.name;name.style.maxWidth='70%';name.style.overflow='hidden';name.style.textOverflow='ellipsis';
          const remove = document.createElement('button');remove.className='btn ghost';remove.textContent='Remove';remove.onclick=()=>{mergeFiles.splice(i,1);renderMergeList()};
          row.appendChild(name);row.appendChild(remove);mergeList.appendChild(row);
        })
      }

      mergeInput.addEventListener('change', (e)=>{
        const files = Array.from(e.target.files).filter(f=>f.type==='application/pdf');
        mergeFiles = mergeFiles.concat(files);
        renderMergeList();
        mergeInput.value = '';
      })

      mergeClear.addEventListener('click', ()=>{mergeFiles=[];renderMergeList();mergeProgress.style.width='0%'; if(lastMergedUrl){URL.revokeObjectURL(lastMergedUrl); lastMergedUrl=null; mergeDownload.style.display='none';}});

      mergeBtn.addEventListener('click', async ()=>{
        if(mergeFiles.length<1){alert('Please select at least one PDF file.');return}
        if(!window.PDFLib){alert('Merging requires PDF-lib to be loaded. Try again in a moment.');return}
        mergeBtn.disabled=true;mergeBtn.textContent='Merging...';mergeProgress.style.width='0%';
        try{
          const PDFLib = window.PDFLib;
          const mergedPdf = await PDFLib.PDFDocument.create();
          let processed = 0;
          for(const file of mergeFiles){
            const arrayBuffer = await file.arrayBuffer();
            const donorPdf = await PDFLib.PDFDocument.load(arrayBuffer);
            const donorPages = await mergedPdf.copyPages(donorPdf, donorPdf.getPageIndices());
            donorPages.forEach((p)=>mergedPdf.addPage(p));
            processed++;
            mergeProgress.style.width = Math.round((processed/mergeFiles.length)*100)+'%';
            await new Promise(r=>setTimeout(r,30));
          }
          const mergedBytes = await mergedPdf.save();
          const blob = new Blob([mergedBytes],{type:'application/pdf'});
          if(lastMergedUrl){URL.revokeObjectURL(lastMergedUrl)}
          lastMergedUrl = URL.createObjectURL(blob);
          mergeDownload.href = lastMergedUrl; mergeDownload.style.display='inline-block';
          // auto-download
          const a = document.createElement('a');a.href=lastMergedUrl;a.download='merged.pdf';document.body.appendChild(a);a.click();a.remove();
        }catch(err){console.error(err);alert('Merging failed: '+(err && err.message || err))}
        mergeBtn.disabled=false;mergeBtn.textContent='Merge Now';mergeProgress.style.width='100%';
      });

      // --- Compress logic ---
      const compressInput = document.getElementById('compress-file');
      const compressList = document.getElementById('compress-list');
      const compressBtn = document.getElementById('compress-button');
      const compressClear = document.getElementById('compress-clear');
      const compressProgress = document.getElementById('compress-progress');
      const compressDownload = document.getElementById('compress-download');
      let compressFile = null; let lastCompressedUrl = null;

      compressInput.addEventListener('change',(e)=>{
        const f = e.target.files[0];
        if(f && f.type==='application/pdf'){compressFile=f;renderCompress();}
        compressInput.value='';
      })
      function renderCompress(){
        compressList.innerHTML='';
        if(!compressFile)return;
        const row = document.createElement('div');row.className='file-row';
        const name = document.createElement('div');name.textContent = compressFile.name;name.style.maxWidth='70%';
        const size = document.createElement('div');size.textContent = (compressFile.size/1024/1024).toFixed(2)+' MB';
        row.appendChild(name);row.appendChild(size);compressList.appendChild(row);
      }

      compressClear.addEventListener('click', ()=>{compressFile=null;renderCompress();compressProgress.style.width='0%'; if(lastCompressedUrl){URL.revokeObjectURL(lastCompressedUrl); lastCompressedUrl=null; compressDownload.style.display='none';}});

      async function canvasToDataUrl(canvas, quality){
        return new Promise((res)=>{
          // Prefer toBlob when available
          if(canvas.toBlob){
            canvas.toBlob((blob)=>{
              const reader = new FileReader();
              reader.onload = ()=>res(reader.result);
              reader.readAsDataURL(blob);
            }, 'image/jpeg', quality);
          }else{
            res(canvas.toDataURL('image/jpeg', quality));
          }
        });
      }

      compressBtn.addEventListener('click', async ()=>{
        if(!compressFile){alert('Please select a PDF file to compress.');return}
        if(!pdfjsLib){alert('Compression requires pdf.js to be loaded. Please wait a moment and try again.');return}
        if(!jsPDFCtor){alert('Compression requires jsPDF to be loaded. Please wait a moment and try again.');return}
        compressBtn.disabled=true;compressBtn.textContent='Compressing...';compressProgress.style.width='0%';
        try{
          const quality = parseFloat(document.getElementById('quality').value);
          const arrayBuffer = await compressFile.arrayBuffer();
          const loadingTask = pdfjsLib.getDocument({data:arrayBuffer});
          const pdf = await loadingTask.promise;
          const total = pdf.numPages;

          // Create jsPDF instance
          const outputPdf = new jsPDFCtor({unit:'pt'});
          for(let i=1;i<=total;i++){
            const page = await pdf.getPage(i);
            // render at scale (reduce for compression)
            const scale = 1.0; // keep moderate quality; quality reduced via JPEG
            const viewport = page.getViewport({scale});
            // To reduce size further, downscale large pages to a max width
            const MAX_WIDTH = 1000; // px - target max width to reduce size
            let renderWidth = Math.floor(viewport.width);
            let renderHeight = Math.floor(viewport.height);
            if(renderWidth > MAX_WIDTH){
              const ratio = MAX_WIDTH / renderWidth;
              renderWidth = Math.floor(renderWidth * ratio);
              renderHeight = Math.floor(renderHeight * ratio);
            }
            const canvas = document.createElement('canvas');
            canvas.width = renderWidth; canvas.height = renderHeight;
            const ctx = canvas.getContext('2d');

            // Render into an offscreen canvas with proper transform
            const renderViewport = page.getViewport({scale: renderWidth / viewport.width});
            const renderContext = {canvasContext: ctx, viewport: renderViewport};
            await page.render(renderContext).promise;

            const dataUrl = await canvasToDataUrl(canvas, quality);
            const imgProps = {width:canvas.width, height:canvas.height};
            const ptWidth = (imgProps.width * 72) / 96;
            const ptHeight = (imgProps.height * 72) / 96;
            if(i>1) outputPdf.addPage([ptWidth,ptHeight]);
            outputPdf.addImage(dataUrl, 'JPEG', 0, 0, ptWidth, ptHeight);
            compressProgress.style.width = Math.round((i/total)*100)+'%';
            await new Promise(r=>setTimeout(r,30));
          }

          // Generate blob from jsPDF and provide download link
          let outBlob = null;
          if(typeof outputPdf.output === 'function'){
            outBlob = outputPdf.output('blob');
          } else if(typeof outputPdf.getBlob === 'function'){
            outBlob = outputPdf.getBlob();
          }
          if(!outBlob){
            // fallback: trigger save which forces download; also try to capture via data URI
            outputPdf.save('compressed.pdf');
            alert('Compression completed. If download did not start, use the Download button.');
            compressBtn.disabled=false;compressBtn.textContent='Compress Now';compressProgress.style.width='100%';
            return;
          }

          // Ensure blob
          const blob = outBlob instanceof Blob ? outBlob : new Blob([outBlob], {type:'application/pdf'});
          if(lastCompressedUrl) URL.revokeObjectURL(lastCompressedUrl);
          lastCompressedUrl = URL.createObjectURL(blob);
          compressDownload.href = lastCompressedUrl; compressDownload.style.display='inline-block';

          // Auto-download with safe revoke timing
          const autoLink = document.createElement('a'); autoLink.href = lastCompressedUrl; autoLink.download = 'compressed.pdf'; document.body.appendChild(autoLink); autoLink.click(); autoLink.remove();
          // revoke after 2 minutes to allow manual download
          setTimeout(()=>{ try{ if(lastCompressedUrl){ URL.revokeObjectURL(lastCompressedUrl); compressDownload.style.display='none'; lastCompressedUrl=null; } }catch(e){} }, 120000);

        }catch(err){console.error(err);alert('Compression failed: '+(err && err.message || err))}
        compressBtn.disabled=false;compressBtn.textContent='Compress Now';compressProgress.style.width='100%';
      });

      // Accessibility: keyboard shortcut to focus upload
      document.addEventListener('keydown',(e)=>{if(e.key==='u' && (e.ctrlKey||e.metaKey)){document.getElementById('merge-files').focus()}})

    });
  </script>
</body>
</html>
